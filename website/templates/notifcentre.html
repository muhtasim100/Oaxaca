{% extends "base.html" %}
{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/notifcenter.css') }}">
<title>
  Oaxaca - Notification Center
</title>
{% endblock %}

{% block content %}
<div class="notifs-content" >
  {% for notif in res %}
  <div class="action" id="{{ notif.NotificationID }}" onclick="Open_Review(this)">
    <div class="user-img"><img src="{{ url_for('static', filename='images/User-Icon.svg') }}" alt="user"></div>

    {% if notif.typeNotification == 1 %}
    <div class="light-img"><img src="{{ url_for('static', filename='images/red-light.svg') }}" alt="redlight"></div>
    {% endif %}

    {% if notif.typeNotification == 2 %}
    <div class="light-img"><img src="{{ url_for('static', filename='images/yellow-light.svg') }}" alt="redlight"></div>
    {% endif %}

    {% if notif.typeNotification == 3 %}
    <div class="light-img"><img src="{{ url_for('static', filename='images/green-light.svg') }}" alt="redlight"></div>
    {% endif %}

    <div class="notif-text"> Table {{ notif.FK_UserID }}
      {% if notif.typeNotification == 1 %}
      has ordered
      {% endif %}

      {% if notif.typeNotification == 2 %}
      has called the waiter
      {% endif %}

      {% if notif.typeNotification == 3 %}
      has paid
      {% endif %}

      {% if notif.typeNotification == 4 %}
      Customer has left
      {% endif %}

      <br>
      {{ notif.TimeNotifcation }}
    </div>
    <div class="notif-img"><img src="{{ url_for('static', filename='images/clickarrow.svg') }}" alt="arrow"></div>
    <div class="delete-button"><img src="{{ url_for('static', filename='images/delete.png') }}" alt="delete-button"></div>
  </div>

  {% for OrderID, productList in products.items() %}
  <div id="p{{ notif.FK_UserID }}" class="fnotif_popup_container" >
    <!-- container for feedback pop up container -->
    <!-- Modal content -->
    <div class="fb-content">
        <div class="fb-header">
            <span class="reviews-bold">Table number: {{ notif.FK_UserID }} 
              <br>Price: {{ totalString }}</span>
        </div>
        <div class="review-textarea">
            <div class="review-text">
              {% for product in productList %}
                <span class="reviews-text-font">{{ products }}</span>
              {% endfor %}
            </div>
        </div>
        
        <div class="review-submit">
            <button id="review-btn" type="button" onclick="closeReview()">Close</button>

        </div>

    </div>
</div>
{% endfor %}

  {% endfor %}

</div>


<!-- <script type="text/javascript">
  function TimeAgo(){
    const date = new Date();

    let day = date.getDate();
    let month = date.getMonth() + 1;
    let year = date.getFullYear();
    let hour = date.getHours();
    let minutes = date.getMinutes();
    let seconds =  date.getSeconds();

    let currentDate = `${day}-${month}-${year}--${hour}--${minutes}--${seconds}`;
    document.getElementById("time-ago").innerHTML = currentDate;
  }
  TimeAgo();
</script> -->

<script>
  // function Overlay_on() {
  //   document.getElementById("overlay").style.display = "block";
  // }
  
  // function Overlay_off() {
  //   document.getElementById("overlay").style.display = "none";
  // }

  function closeReview() {        
      var popups = Array.from(document.getElementsByClassName("fnotif_popup_container"));
      // Overlay_off();
      popups.forEach(function(popup) { 
          popup.style.display = "none";
      });
  }

  function Open_Review(element) {
      var review = element;
      var review_id = element.id.substring(1);
      document.querySelector(".fnotif_popup_container#p" + review_id).style.display = "flex";
      // Overlay_on();
  }
</script>


<script>
  let notif_div = Array.from(document.querySelectorAll(".action"));
  notif_div.forEach(function (action) {
    let delete_button = action.querySelector(".delete-button");
    if (delete_button) {
      action.onmouseover = function() {
        delete_button.style.visibility = "visible";
      }
      action.onmouseout = function() {
        delete_button.style.visibility = "hidden";
      }

      delete_button.onclick = function() {
        $.ajax({
          url: '/delete_notif',
          type: 'POST',
          data: {id: action.id},
          success: function(data) {
            $(".content").prepend('<div class="notification"><div class="notification-message"></div></div>');
            $(".notification-message").html("Notification deleted!");
          },
          error: function(error) {
            console.log(error);
          }
        });
        action.remove();
      }
    }
  });
</script>

{% endblock %}


<!-- for OrderID, productList in products.items():
      #This is where you'd open the div for the popup with the order info
      #You'd put the OrderID as like a heading or something and the total price
      for product in productList:
        pass
        #instead of pass, here is where you'd do put each line of text that's like 1x Taco (Â£5.99) (presumably within a cointainer div)

     #After the inner for loop you'd close the div with all the products

   #This is where you'd close the div code for the popup -->